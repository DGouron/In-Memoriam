!function(){var e={},t=[null];function n(n,o,r){e[n]={dependencies:o,factory:r},t[0]=n}n("require",["exports"],function(e){Object.defineProperty(e,"__cjsModule",{value:!0}),Object.defineProperty(e,"default",{value:function(e){return i(e)}})});var o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};n("models/filters.model",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),n("models/death.model",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),n("models/definition.model",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),n("models/bloodbath.model",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),n("models/index",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),n("permalink",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.build=function(e){var t=document.querySelector('[data-role="permalink"]'),n=location.href.replace(/#.*$/,""),o="";for(var r in e)if(e.hasOwnProperty(r)){var i=e[r];i&&(o+=(o?"&":"#")+r+"="+i)}t.value=n+o},e}();t.Permalink=n}),n("config",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this._config={},this._definitions=null,this._configPath="./data/config/settings.json",this._definitionsPath="./data/config/definitions.json",this.init(e)}return e.prototype.init=function(e){var t=this;qwest.get(this._configPath).then(function(n,o){t._config=o.settings,qwest.get(t._definitionsPath).then(function(n,o){t._definitions=o.definitions,e&&e()})})},e.prototype.getConfig=function(e){return this._config[e]},e.prototype.getDefinitions=function(){return this._definitions},e}();t.Config=n}),n("events",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.addEventHandler=function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on "+t,n)},e.removeEventHandler=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)},e}();t.Events=n}),n("helper/stringUtils.helper",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.normalizeString=function(e){return e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase()},e.containsString=function(t,n){return e.normalizeString(t).includes(n)},e}();t.StringUtilsHelper=n}),n("helper/gmapUtils.helper",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.bindButton=function(e,t,n){var o=document.createElement("div"),r=document.createElement("button"),i=document.createElement("div");return r.style.backgroundColor="#FFF",r.style.border="none",r.style.borderRadius="2px",r.style.boxShadow="0 1px 4px rgba(0,0,0,0.3)",r.style.cursor="pointer",r.style.height="28px",r.style.marginTop="10px",r.style.marginLeft="10px",r.style.outline="none",r.style.padding="0px",r.style.width="28px",r.title=n.title,o.appendChild(r),i.id=n.ctrlChildId?n.ctrlChildId:"ctrl-child-"+Math.floor(1e3*Math.random()),i.className="ctrl-child",i.style.backgroundImage="url("+n.imagePath+")",i.style.backgroundPosition=n.defaultCtrlChildBgPos?n.defaultCtrlChildBgPos:"0 0",i.style.backgroundRepeat="no-repeat",i.style.backgroundSize=n.defaultCtrlChildBgSize?n.defaultCtrlChildBgSize:"100%",i.style.height="18px",i.style.margin="5px",i.style.width="18px",r.appendChild(i),r.addEventListener("click",t),e.controls[n.ctrlPosition].push(o),o},e}();t.GmapUtils=n}),n("inMemoriam",["require","exports","permalink","config","events","helper/stringUtils.helper","helper/gmapUtils.helper"],function(e,t,n,r,i,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(){this._currentInfoWindows=null,this._eventHandlers={},this._heatMap=null,this._imgHousePath="./assets/images/corps/%house%.png",this._infoWindows=[],this._markerCluster=null,this._markers=[],this._configObject=null}return e.getFilterValueLabel=function(e,t){var n=document.querySelector('form select[name="'+e+'"] option[value="'+t+'"]');return(n?n.innerText:t).replace(/\([\d]+\)/,"").trim()},e.prototype.boot=function(){var e=this;this._configObject=new r.Config(function(){return e.run()})},e.prototype.run=function(){var e={center:new google.maps.LatLng(this.getConfig("defaultLat"),this.getConfig("defaultLon")),mapTypeControl:!1,mapTypeId:google.maps.MapTypeId.HYBRID,maxZoom:this.getConfig("maxZoom"),streetViewControl:!1,zoom:this.getConfig("defaultZoom")},t=document.getElementById("form-filters"),n=document.getElementById("map"),o=new google.maps.Map(n,e);this.bindAnchorEvents(o,n,t),this.bindFilters(o,n,t),this.bindLocalizationButton(o),this.bindRandomizationButton(o),this.bindMarkers(n.dataset.bloodbathSrc,o,this.getFilters(t,!0))},e.prototype.getConfig=function(e){return this._configObject.getConfig(e)},e.prototype.getConfigDefinitions=function(){return this._configObject.getDefinitions()},e.prototype.filteredResponse=function(e,t){for(var n=e,o=0,r=Object.entries(t);o<r.length;o++){var i=r[o],s=i[0],l=i[1];if(t.hasOwnProperty(s)){var u=s,c=a.StringUtilsHelper.normalizeString(l);if(l)for(var d=n.deaths.length;d--;)"search"===u&&l.length>=3?a.StringUtilsHelper.containsString(n.deaths[d].text,c)||a.StringUtilsHelper.containsString(n.deaths[d].section,c)||a.StringUtilsHelper.containsString(n.deaths[d].location,c)||a.StringUtilsHelper.containsString(n.deaths[d].keywords,c)||n.deaths.splice(d,1):(!n.deaths[d].published||n.deaths[d][u]&&n.deaths[d][u]!==l)&&n.deaths.splice(d,1)}}return n},e.prototype.getFilters=function(e,t){var n=location.hash.substr(1).split("&"),o={},r={},i=e.querySelectorAll('select[data-filterable="true"], input[data-filterable="true"]');return n.forEach(function(e){var t=e.split("=");2===t.length&&(o[t[0]]=t[1])}),i.forEach(function(e){t&&void 0!==o[e.id]?r[e.id]=o[e.id]:r[e.id]=e.value}),r},e.prototype.alterFiltersLabels=function(e){document.querySelectorAll("form select").forEach(function(t){var n=t.querySelectorAll("option");"true"===t.dataset.countable&&n.forEach(function(n){if(""!==n.value){for(var o in n.dataset.deathCount="0",e.deaths){var r=e.deaths[o];n.value===r[t.name]&&(n.dataset.deathCount=""+(+n.dataset.deathCount+r.count))}n.innerText=n.innerText.replace(/\([\d]+\)/,"")+" ("+n.dataset.deathCount+")"}})})},e.prototype.bindAnchorEvents=function(e,t,n){var o=this;window.addEventListener("hashchange",function(){o.bindFilters(e,t,n,!0),o.bindMarkers(t.dataset.bloodbathSrc,e,o.getFilters(n,!0))},!1)},e.prototype.bindFilters=function(e,t,n,o){var r=this,a=n.querySelectorAll("form select, form input");i.Events.addEventHandler(n,"submit",function(e){e.preventDefault()}),a.forEach(function(a){var s=r.getFilters(n,o);a.value=void 0!==s[a.name]?s[a.name]:"","function"==typeof r._eventHandlers[a.id]&&i.Events.removeEventHandler(a,"change",r._eventHandlers[a.id]),r._eventHandlers[a.id]=function(){var i=r.getFilters(n,o);return r.bindMarkers(t.dataset.bloodbathSrc,e,i),!1},o&&(a.value=void 0!==s[a.name]?s[a.name]:""),i.Events.addEventHandler(a,"change",r._eventHandlers[a.id])})},e.prototype.clearMarkerCluster=function(){return this._markerCluster&&this._markerCluster.clearMarkers(),this},e.prototype.bindMarkers=function(t,r,i){var a=this;qwest.get(t.replace("%year%",i.year)+"?_="+(new Date).getTime()).then(function(t,s){var l=new google.maps.LatLngBounds,u=[],c=[],d=[],p=s;if(a.alterFiltersLabels(p),p=a.filteredResponse(p,i),a.clearMapObjects(),p.deaths&&p.deaths.length){var f=function(t){var n=p.deaths[t],o=a._imgHousePath.replace("%house%",n.house),i=new google.maps.Marker({map:r,icon:new google.maps.MarkerImage(o),position:new google.maps.LatLng(n.gps.lat,n.gps.lon),title:n.text}),s='\'<h4>\n              <img height="16" src="'+o+'" alt="House: '+n.house+'"  title="House: '+n.house+'" />\n              '+(n.section?n.section+" - ":"")+"\n              "+n.location+"\n              "+(n.count>1?' - <strong style="color: red;">'+n.count+" décès</strong>":"")+"\n            </h4>\n            <span>\n              <strong>Date</strong>: "+n.day+"/"+n.month+"/"+n.year+"\n              <br /><br />\n              <strong>Cause</strong>: "+e.getFilterValueLabel("cause",n.cause)+"\n              <br /><br />\n              <strong>Circonstances</strong>:  "+n.text+"\n            </span>";if(n.sources&&n.sources.length){var l="";for(var f in n.sources){var g=n.sources[f];l+=(l?", ":"")+'<a href="'+g.url+'" target="_blank">'+g.titre+"</a>"}s+="<br /><br /><strong>Sources: </strong>"+l}s+='<br /><small style="float: right"><a href="mailto:contact@geolim4.com?subject='+("Erreur trouvée - "+n.section+" + -  "+n.day+"/"+n.month+"/"+n.year)+'">[Une erreur ?]</a></small>';var h=new google.maps.InfoWindow({content:s});google.maps.event.addListener(i,"click",function(){a._currentInfoWindows&&a._currentInfoWindows.close(),h.open(r,i),a._currentInfoWindows=h}),a._infoWindows.push(h),"interieur"===n.origin?d.push(i):u.push(i),c.push({location:new google.maps.LatLng(n.gps.lat,n.gps.lon),weight:10+(n.count>1?5*n.count:0)}),a._markers.push(i)};for(var g in p.deaths)f(g);a._markerCluster=new MarkerClusterer(r,a._markers,{gridSize:60,imagePath:"./assets/images/clustering/m",maxZoom:14});var h=d.length?d:u;for(var g in h)h.hasOwnProperty(g)&&l.extend(h[g].getPosition());c.length&&(a._heatMap=new google.maps.visualization.HeatmapLayer(o({data:c},a.getConfig("heatmapOptions"))),a._heatMap.setMap(r)),n.Permalink.build(i),a.printDefinitionsText(s),r.fitBounds(l)}else a.printDefinitionsText(null)})},e.prototype.clearMapObjects=function(){this.clearMarkers().clearInfoWindows().clearHeatMap().clearMarkerCluster()},e.prototype.clearMarkers=function(){for(var e=0;e<this._markers.length;e++)this._markers[e].setMap(null);return this._markers=[],this},e.prototype.clearInfoWindows=function(){for(var e=0;e<this._infoWindows.length;e++)google.maps.event.clearInstanceListeners(this._infoWindows[e]),this._infoWindows[e].close();return this._infoWindows=[],this},e.prototype.clearHeatMap=function(){return this._heatMap&&this._heatMap.setMap(null),this},e.prototype.bindLocalizationButton=function(e){var t=this,n={ctrlChildId:"localizationImg",ctrlPosition:google.maps.ControlPosition.LEFT_TOP,defaultCtrlChildBgSize:"180px 18px",imagePath:this.getConfig("imagePath").localize,title:"Voir autour de moi"};s.GmapUtils.bindButton(e,function(){var n=new google.maps.Marker({map:e,animation:google.maps.Animation.DROP,icon:new google.maps.MarkerImage(t.getConfig("imagePath").bluedot),position:{lat:31.4181,lng:73.0776}}),o="0",r=setInterval(function(){var e=document.querySelector("#localizationImg");o=-18==+o?"0":"-18",e.style.backgroundPosition=o+"px 0px"},500);confirm("La demande de localisation ne servira qu'à positionner la carte autour de vous, aucune donnée ne sera envoyée ni même conservée nulle part.")&&navigator.geolocation?navigator.geolocation.getCurrentPosition(function(o){var i=new google.maps.LatLng(o.coords.latitude,o.coords.longitude);n.setPosition(i),e.setCenter(i),e.setZoom(12);var a=new google.maps.InfoWindow({content:"Ma position approximative"});google.maps.event.addListener(n,"click",function(){t._currentInfoWindows&&t._currentInfoWindows.close(),a.open(e,n),t._currentInfoWindows=a}),a.open(e,n),document.querySelector("#localizationImg").style.backgroundPosition="-144px 0px",clearInterval(r)}):(clearInterval(r),document.querySelector("#localizationImg").style.backgroundPosition="0px 0px")},n),google.maps.event.addListener(e,"dragend",function(){document.querySelector("#localizationImg").style.backgroundPosition="0px 0px"})},e.prototype.bindRandomizationButton=function(e){var t=this,n={ctrlChildId:"ramdomImg",ctrlPosition:google.maps.ControlPosition.LEFT_TOP,defaultCtrlChildBgPos:"-2px -2px",defaultCtrlChildBgSize:"120%",imagePath:this.getConfig("imagePath").random,title:"Marqueur aléatoire"};s.GmapUtils.bindButton(e,function(){var n=Math.floor(Math.random()*t._markers.length),o=t._markers[n];e.setCenter(o.getPosition()),e.setZoom(13),google.maps.event.trigger(o,"click")},n)},e.prototype.getDefinitions=function(e){var t={};for(var n in this.getConfigDefinitions())for(var o in e.deaths)if(e.deaths.hasOwnProperty(o)){var r=e.deaths[o];t[n]||(t[n]={}),t[n][r[n]]||(t[n][r[n]]=0),Number.isInteger(r.count)&&r.count>1?t[n][r[n]]+=r.count:t[n][r[n]]++}return t},e.prototype.printDefinitionsText=function(e){var t=[];if(e)for(var n=this.getDefinitions(e),o=this.getConfigDefinitions(),r=0,i=Object.entries(n);r<i.length;r++){for(var a=i[r],s=a[0],l=a[1],u="",c=0,d=Object.entries(l);c<d.length;c++){var p=d[c],f=p[0],g=p[1],h=g>1;if(o[s][f])u+=(u?", ":"")+o[s][f][h?"plural":"singular"].replace("%d",g).replace("%"+s+"%",f);else if(o[s]["#any"]){u+=(u?", ":"")+o[s]["#any"][h?"plural":"singular"].replace("%d",g).replace("%"+s+"%",f)}else u+=(u?", ":"")+"["+f+"] ("+g+")"}t.push(o[s]["#label"].replace("%"+s+"%",u))}else t.push("Aucun r&#233;sultat trouv&#233;");document.querySelector('[data-role="definitionsText"]').innerHTML=t.join("<br />")},e}();t.InMemoriam=l}),n("main",["require","exports","inMemoriam"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),document.addEventListener("DOMContentLoaded",function(){(new n.InMemoriam).boot()})});var r={};function i(t){if(r[t])return r[t];if("exports"===t)return{};var n=function(t){return e[t]?e[t]:e[t+"/index"]?e[t+"/index"]:{dependencies:["exports"],factory:function(e){try{Object.defineProperty(e,"__cjsModule",{value:!0}),Object.defineProperty(e,"default",{value:require(t)})}catch(e){throw Error(['module "',t,'" not found.'].join(""))}}}}(t);r[t]={};var o=n.dependencies.map(function(e){return i(e)});n.factory.apply(n,o);var a=o[n.dependencies.indexOf("exports")];return r[t]=a.__cjsModule?a.default:a,r[t]}if(null!==t[0])i(t[0])}();